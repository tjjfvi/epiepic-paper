<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>Epic Paper Sim</title>

		<link rel="stylesheet" href="bundle.css">
		<script src="bundle.js"></script>
	</head>
	<body style="display: none;" data-bind="visible: true">

		<a class="login" href="/login" data-bind="visible: !user()">Login (via Discord)</a>

		<div class="intro" data-bind="visible: status() === 'waiting' && user(), with: intro">
			<div class="join">
				<h1>Join an existing game</h1>
				<!-- ko foreach: games -->
				<div class="game" data-bind="css: { pswd: pswdReq }">
					<span>
						<span data-bind="text: name || '[unnamed]'">T6</span>
					</span>
					<div>
						<input type="password" data-lpignore="true" placeholder="Password" data-bind="value: pswd, css: { wrong }"/>
						<button data-bind="click: join">Join</button>
					</div>
				</div>
				<!-- /ko -->
			</div>

			<div class="host" data-bind="with: host">
				<h1>Host a new game</h1>
				<label>
					<span>Password <i>(optional)</i></span>
					<input type="password" data-lpignore="true" data-bind="value: pswd"/>
				</label>
				<button data-bind="click: host">Host</button>
			</div>

		</div>

		<div class="waiting" data-bind="visible: status() === 'hosting'">
			Waiting for someone to join...
		</div>

		<div class="paper" data-bind="with: paper, visible: status() === 'playing'">
			<div class="chooseDeck" data-bind="visible: !deckChoice.done(), with: deckChoice">
				<input placeholder="Deck ID" data-bind="value: deckId, css: { wrong }"/>
				<button data-bind="click: submitDeck">Submit</button>
			</div>	
			<div class="waiting" data-bind="visible: deckChoice.done() && !started()">
				Waiting for the other player...
			</div>
			<div class="game" data-bind="if: started(), visible: started()">
				<div class="supps">
					<div>
						<div class="user o" data-bind="user: oUser">
							<div class="avatarGroup">
								<div class="gold" data-bind="attr: { g: +o.gold() }, click: () => o.gold(!o.gold())"></div>
								<img class="avatar" data-bind="attr: { src: `/api/user:${oUser()._id}/avatar` }"/>
								<input class="health" data-bind="textInput: o.health, css: { wrong: !vs.health(o.health()) }"/>
							</div>
							<span class="username" data-bind="text: `@${oUser().username}#${oUser().discriminator}`"></span>
						</div>
						<div class="supp o" data-bind="cards: oSupp, main: 'mark'"></div>
					</div>
					<div>
						<div class="supp p" data-bind="cards: pSupp, main: 'disc', alt: 'disc play hand banis'"></div>
						<div class="user p" data-bind="if: pUser">
							<div class="avatarGroup">
								<div class="gold" data-bind="attr: { g: +p.gold() }, click: () => p.gold(!p.gold())"></div>
								<img class="avatar" data-bind="attr: { src: `/api/user:${pUser()._id}/avatar` }"/>
								<input class="health" data-bind="textInput: p.health, css: { wrong: !vs.health(p.health()) }"/>
							</div>
							<span class="username" data-bind="text: `@${pUser().username}#${pUser().discriminator}`"></span>
						</div>
					</div>
				</div>
				<div class="main">
					<div class="hand o" data-bind="cards: oHand, main: 'mark', alt: 'unrevealO'"></div>
					<div class="play o" data-bind="cards: oPlay, main: 'mark'"></div>
					<div class="play p" data-bind="cards: pPlay, main: 'battle', alt: 'prepare expend flip disc hand supp banish'"></div>
					<div class="hand p" data-bind="cards: pHand, main: 'playCard', alt: 'playCard reveal unreveal disc deck banish'"></div>
				</div>
				<div class="right">
					<div class="dd o">
						<img class="deck o" data-bind="attr: { src: (oDeck()[0]||{}).src }"/>
						<div class="disc o" data-bind="
							cards: oDisc,
							main: 'hand',
							alt: 'hand playCard banish',
							css: { ['n' + Math.ceil(Math.sqrt(oDisc().length))]: true },
						"></div>
					</div>
					<div class="il">
						<div class="i">
							<div class="o">
								<div class="initiative o" data-bind="
									css: { on: +game.initiative() !== n(), hideInitiative },
									click: () => game.initiative(!game.initiative()),
								"></div>
								<div class="waiting o" data-bind="
									css: { on: o.waitingOn() },
									click: () => (o.waitingOn(!o.waitingOn()), p.waitingOn(false)),
								"></div>
							</div>
							<div class="tp" data-bind="event: { click: cyclePhase, contextmenu: cyclePhaseAlt }">
								<span class="turn" data-bind="text: game.turn() ^ n() ? 'Their turn' : 'Your turn'"></span>
								<span class="phase" data-bind="text: phaseName()"></span>
							</div>
							<div class="p">
								<div class="initiative p" data-bind="
									css: { on: +game.initiative() === n(), hideInitiative },
									click: () => game.initiative(!game.initiative()),
								"></div>
								<div class= "waiting p" data-bind="
									css: { on: p.waitingOn() },
									click: () => (p.waitingOn(!p.waitingOn()), o.waitingOn(false)),
								"></div>
							</div>
						</div>
					</div>
					<div class="dd p">	
						<img class="deck o" data-bind="click: draw, attr: { src: (pDeck()[0]||{}).src }"/>
						<div class="disc p" data-bind="
							cards: pDisc,
							main: 'hand',
							alt: 'hand playCard banish',
							css: { ['n' + Math.ceil(Math.sqrt(pDisc().length))]: true },
						"></div>
					</div>
				</div>
				<div class="rightClick" data-bind="foreach: rightClick()">
					<span data-bind="click: func, text: name"></span>
				</div>
				<div class="popup cardPopup" data-bind="
					css: { hide: !cardPopup() },
					click: () => cardPopup(null),
					with: cardPopup,
				">
					<img data-bind="attr: { src }"/>
				</div>
			</div>
		</div>

	</body>
</html>
